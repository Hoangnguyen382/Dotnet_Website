@page "/restaurant/create"
@using Layout_Admin.Model.DTO
@using Layout_Admin.Service
@inject RestaurantService RestaurantService
@inject UploadService UploadService
@inject NavigationManager Navigation

<h3 class="mb-4 text-center">ğŸŒŸ ThÃªm NhÃ  HÃ ng Má»›i ğŸŒŸ</h3>

<div class="card shadow p-4 mx-auto" style="max-width: 900px;">
    <EditForm Model="restaurant" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="row g-4">
            <div class="col-md-7">
                <div class="form-floating mb-3">
                    <InputText class="form-control" id="name" @bind-Value="restaurant.Name" placeholder="TÃªn nhÃ  hÃ ng" />
                    <label for="name">TÃªn nhÃ  hÃ ng</label>
                </div>

                <div class="form-floating mb-3">
                    <InputText class="form-control" id="address" @bind-Value="restaurant.Address" placeholder="Äá»‹a chá»‰" />
                    <label for="address">Äá»‹a chá»‰</label>
                </div>

                <div class="form-floating mb-3">
                    <InputText class="form-control" id="phone" @bind-Value="restaurant.PhoneNumber" placeholder="Sá»‘ Ä‘iá»‡n thoáº¡i" />
                    <label for="phone">Sá»‘ Ä‘iá»‡n thoáº¡i</label>
                </div>

                <div class="form-floating mb-3">
                    <InputText class="form-control" id="hours" @bind-Value="restaurant.OpeningHours" placeholder="Giá» má»Ÿ cá»­a" />
                    <label for="hours">Giá» má»Ÿ cá»­a</label>
                </div>

                <div class="form-floating mb-3">
                    <InputTextArea class="form-control" style="height: 100px" id="description" @bind-Value="restaurant.Description" placeholder="MÃ´ táº£" />
                    <label for="description">MÃ´ táº£</label>
                </div>

                <div class="form-check form-switch mb-3">
                    <InputCheckbox class="form-check-input" id="isActive" @bind-Value="restaurant.IsActive" />
                    <label class="form-check-label" for="isActive">Äang hoáº¡t Ä‘á»™ng</label>
                </div>

                <button type="submit" class="btn btn-primary mt-2 w-100">ğŸ’¾ LÆ°u NhÃ  HÃ ng</button>
            </div>

            <div class="col-md-5 d-flex flex-column align-items-center justify-content-start">
                <label class="form-label fw-bold">Logo nhÃ  hÃ ng:</label>
                <InputFile OnChange="UploadLogo" class="form-control mb-3" />
                @if (!string.IsNullOrEmpty(restaurant.LogoUrl))
                {
                    <img src="@restaurant.LogoUrl" class="img-thumbnail" style="max-width: 200px;" />
                }
                else
                {
                    <div class="border rounded p-3 text-muted text-center" style="width: 200px;">
                        ChÆ°a cÃ³ logo
                    </div>
                }
            </div>
        </div>
    </EditForm>
</div>

@code {
    private RestaurantRequestDTO restaurant = new();

    private async Task HandleSubmit()
    {
        var success = await RestaurantService.CreateRestaurantAsync(restaurant);
        if (success)
        {
            Navigation.NavigateTo("/restaurant");
        }
    }

    private async Task UploadLogo(InputFileChangeEventArgs e)
    {
        var file = e.File;
        var result = await UploadService.UploadImageAsync(file);
        if (!string.IsNullOrEmpty(result))
        {
            restaurant.LogoUrl = result;
        }
    }
}
